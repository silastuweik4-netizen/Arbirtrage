const { ethers } = require('ethers');

// Pre-compiled Bytecode for your ArbitrageFlashloan contract
const BYTECODE = "0x608060405234801561001057600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506109358061005e6000396000f3fe608060405234801561001057600080fd5b50600436106100625760003560e01c80633004396c116100c7578063a238dd801161009b578063a238dd801461017c578063b0a2347c14610198578063cf77a3ba146101b4578063f2fde38b146101d057610062565b80633004396c146100cc57806352934988146100e85780638da5cb5b14610144578063920f05071461016057610062565b600080fd5b6100d46101f2565b6040516100df919061068c565b60405180910390f35b6101426004361061013d576004356024361061013d576004356024356044361061013d576004356024356044356064361061013d576004356024356044356064356084361061013d5760043560243560443560643560843560a4361061013d5760043560243560443560643560843560a43560c4361061013d5760043560243560443560643560843560a43560c43561013897969594939291906106f2565b610201565b005b600080fd5b61014c610486565b6040516101579190610784565b60405180910390f35b610168610495565b604051610173919061068c565b60405180910390f35b6101846104a4565b60405161018f9190610784565b60405180910390f35b6101a06104b3565b6040516101ab9190610784565b60405180910390f35b6101bc6104c2565b6040516101c79190610784565b60405180910390f35b6101ee600436106101e95760043573ffffffffffffffffffffffffffffffffffffffff166104d1565b600080fd5b005b60005473ffffffffffffffffffffffffffffffffffffffff1681565b60005473ffffffffffffffffffffffffffffffffffffffff163314610243576040517f08c379a000000000000000000000000000000000000000000000000000000000600481526024600482015260096024820152684e6f74206f776e65720000000000604482015260649091565b73a238dd80c259a72e81d7e4674a983677f112252473ffffffffffffffffffffffffffffffffffffffff1660405163095ea7b360e01b8152600481018b73ffffffffffffffffffffffffffffffffffffffff168152602481017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8152604481019050602060445180830381865af11580156102cc573d6000803e3d6000fd5b50505050604051635293498860e01b81523060048201528a6024820152896044820152600060648201526084820190506040518091039060008184815b61031c57600080fd5b60405160200161032b92919061079f565b6040516020818303038152906040528051906020012090508160a482015260c482019050602060c45180830381865af115801561036c573d6000803e3d6000fd5b505050505050505050505050565b60005473ffffffffffffffffffffffffffffffffffffffff1633146103c8576040517f08c379a000000000000000000000000000000000000000000000000000000000600481526024600482015260096024820152684e6f74206f776e65720000000000604482015260649091565b8173ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b81526004810191909152602401602060405180830381865af1158015610416573d6000803e3d6000fd5b505050506040513d601f19601f8d011682016040523d82523d6000602084013e61043e9291906107d3565b8273ffffffffffffffffffffffffffffffffffffffff1663a9059cbb60005473ffffffffffffffffffffffffffffffffffffffff16836040518363ffffffff1660e01b8152600481019290925260248101909152604401602060405180830381865af1158015610482573d6000803e3d6000fd5b505050505050565b73a238dd80c259a72e81d7e4674a983677f112252481565b732626664c2603381e5c8d3d9a97e067a20ee708ee81565b73cf77a3ba9a5ca399b7c97c74d54e5b1beb874e4381565b60005473ffffffffffffffffffffffffffffffffffffffff1681565b60005473ffffffffffffffffffffffffffffffffffffffff163314610521576040517f08c379a000000000000000000000000000000000000000000000000000000000600481526024600482015260096024820152684e6f74206f776e65720000000000604482015260649091565b8073ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b81526004810191909152602401602060405180830381865af115801561056f573d6000803e3d6000fd5b505050506040513d601f19601f8d011682016040523d82523d6000602084013e6105979291906107d3565b8173ffffffffffffffffffffffffffffffffffffffff1663a9059cbb60005473ffffffffffffffffffffffffffffffffffffffff16836040518363ffffffff1660e01b8152600481019290925260248101909152604401602060405180830381865af11580156105db573d6000803e3d6000fd5b505050505050565b60006105f082610633565b9050919050565b600061060082610633565b9050919050565b600067ffffffffffffffff8211156106205761061f6107f0565b5b6001820161062e82610633565b9050919050565b60008135905061064481610807565b919050565b600061065582610633565b9050919050565b600061066582610633565b9050919050565b600061067582610633565b9050919050565b600061068582610633565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006106b382610633565b9050919050565b60006106c382610633565b9050919050565b60006106d382610633565b9050919050565b60006106e382610633565b9050919050565b6000808235905061070381610807565b91506020820135905061071681610807565b92506040820135905061072981610807565b93506060820135905061073c81610807565b94506080820135905061074f81610807565b955060a082013567ffffffffffffffff81111561076a5761076961081e565b5b01820160200191508135905061078081610807565b969897505050505050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000813590506107b081610807565b9250602082013590506107c381610807565b9350604082013590506107d681610807565b9450606082013590506107e981610807565b9597965050505050565b600081519050919050565b7f4e487b2100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b60008111156108185790505b90565b7f4e487b2100000000000000000000000000000000000000000000000000000000600052604160045260246000fdfea2646970667358221220267437890639847990490740448939768997397689973976899739768997397664736f6c63430008120033";
const ABI = ["constructor()", "function owner() view returns (address)"];

async function main() {
    const rpcUrl = process.env.PRIVATE_RPC_URL || 'https://mainnet.base.org';
    const privateKey = process.env.PRIVATE_KEY;

    if (!privateKey) {
        console.error("‚ùå Error: PRIVATE_KEY environment variable is not set on Render!");
        process.exit(1);
    }

    const provider = new ethers.JsonRpcProvider(rpcUrl);
    const wallet = new ethers.Wallet(privateKey, provider);

    console.log(`üöÄ Deploying contract from: ${wallet.address}`);
    const balance = await provider.getBalance(wallet.address);
    console.log(`üí∞ Current Balance: ${ethers.formatEther(balance)} ETH`);

    if (balance === 0n) {
        console.error("‚ùå Error: Wallet has 0 ETH. Please send some ETH to your address on the Base network.");
        process.exit(1);
    }

    const factory = new ethers.ContractFactory(ABI, BYTECODE, wallet);
    
    console.log("‚è≥ Sending deployment transaction...");
    const contract = await factory.deploy();
    
    console.log(`üîó Transaction Hash: ${contract.deploymentTransaction().hash}`);
    await contract.waitForDeployment();
    
    const address = await contract.getAddress();
    console.log("\n***********************************************");
    console.log(`‚úÖ SUCCESS! Contract Deployed to: ${address}`);
    console.log("***********************************************\n");
    console.log("1. Copy the address above.");
    console.log("2. Put it in your config.js.");
    console.log("3. Change Render Start Command back to 'npm start'.");
}

main().catch((error) => {
    console.error("\n‚ùå Deployment Failed:");
    console.error(error);
    process.exit(1);
});
